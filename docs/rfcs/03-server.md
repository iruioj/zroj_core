# Server 模块架构



## `server::app`

`app` 本身是后端应用的集成，提供一个 Actix Web 服务的配置函数。

`app` 下面会有一系列的子模块，表示不同的网络应用服务，子模块提供的是`web::scope`。

## `server::data`

`data` 模块提供**持久化数据**处理相关的服务，也就是说这类数据在服务器关闭后仍保留。常用的 MySQL 等数据库的处理都放在这个模块。

`data` 下也会有一系列子模块，表示不同类型（用户、题目、博客……）的数据管理服务。每个模块提供一个或多个 "manager trait" 描述数据管理服务，并提供至少一种实现（一般是文件存储、数据库存储、内存存储均提供，分别用于轻量级部署、完整部署和测试）。

所提供的接口，主要是提供给 `server::app` 或者 `server::auth` 使用，不考虑外部手动调用的情况。

## `server::auth`

这个模块提供用户鉴权的相关服务。

用户鉴权是指鉴别用户是否存在并获取其身份。

注意，鉴权不止有 session（比如如果我们要提供题目数据版本化管理，那就是 git http 或者 ssh 的鉴权）。因此这部分的设计要留余地。最好是抽象出 trait。

## `server::permission`

这个模块提供用户权限相关服务。

权限不需要做鉴权的事情，只需要根据**已有的身份信息**判断他是否具有获取某种资源的许可。

将两者分开的原因是，鉴权失败对应的错误是 unauthorized，而没有权限对应的是 403。

此外，权限操作一般是管理员或者出题人会用到，所以可以做一些 heavy 的查询，但是鉴权几乎在每次请求都会有，需要注意性能。

## 附注

`server` 不需要处理环境变量和 config 的读取，这些交给 cli 做，cli 把读取的 config 以参数的形式传递给 `server::app` 中的应用即可。